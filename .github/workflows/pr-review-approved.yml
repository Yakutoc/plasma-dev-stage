name: TEST

on:
    workflow_dispatch:
    pull_request_review:
        types: [ submitted ]

jobs:
    check-approvals:
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout repository
                uses: actions/checkout@v4

            -   name: Count Approvals Using GitHub Script
                id: count_approvals
                uses: actions/github-script@v7
                with:
                    result-encoding: string
                    script: |
                        const { data: reviews } = await github.rest.pulls.listReviews({
                          owner: 'salute-developers',
                          repo: 'plasma',
                          pull_number: 1364,
                        });

                        const approvals = reviews.filter(({ state }) => state === 'APPROVED').length;

                        return approvals;

            -   name: Send notification
                if: ${{ steps.count_approvals.outputs.result >= '2' }}
                uses: mattermost/action-mattermost-notify@master
                with:
                    MATTERMOST_WEBHOOK_URL: ${{ secrets.WEBHOOKS_NOTIFICATIONS_MM }}
                    TEXT: |
                        **Название**: "plasma-{web,b2c}: update ModalBase modalOverlayColor token"
                        **PR**: https://github.com/salute-developers/plasma/pull/1364
                        **Автор**: @alex_czech
